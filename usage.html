<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>H'Biang Cà Phê - Tích Cực, Sảng Khoái</title>

    <meta name="description" content="Cà phê Arabica rang xay nguyên chất, cà phê chính gốc Đà lạt" />
    <meta name="keywords" content="cà phê, coffee, arabica, cà phê nguyên chất, cà phê Đà Lạt" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" media="screen" href="/v2/res/lib/tether/css/tether.min.css">
    <link rel="stylesheet" media="screen" href="/v2/res/lib/bootstrap/css/meteria.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css">
    <link rel="stylesheet" media="screen" href="/v2/res/css/index.css?v0016">
</head>

<body>
    <nav class="navbar navbar-light scrolling-navbar bg-faded">
        <button class="navbar-toggler hidden-sm-up float-xs-right" type="button" data-toggle="collapse" data-target="#collapseEx2">
        </button>
        <div class="container clearfix">
            <div style="float:left">
                <a href="/">
                    <img src="/v2/res/images/logo.png" style="width: 300px;" alt="">
                </a>
            </div>
            <div class="collapse navbar-toggleable-xs" id="collapseEx2" style="float: right;height: 80px;">
                <ul class="nav navbar-nav" style="margin-top:20px">
                    <li class="nav-item">
                        <a class="nav-link" href="/">TRANG CHỦ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#features">ĐẶC ĐIỂM</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#products">SẢN PHẨM</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#services">DỊCH VỤ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#contact">LIÊN HỆ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <a id="home"></a>

    <div style="border-top: solid 1px #ccc;min-height: 300px;padding-top: 20px;">
        <div class="container">
            <h2>
                Hướng dẫn mua hàng:
            </h2>
            <br>
            <div style="font-size: 18px;">
                <p>
                    1. Chọn sản phẩm cần mua
                </p>
                <p>
                    <img width="300px" src="/v2/res/images/usage_01.png" alt="Chọn sản phẩm">
                </p>
                <p>
                    2. Nhập số lượng cần mua và thông tin giao nhận, ghi chú nếu có
                </p>
                <p>
                    <img width="300px" src="/v2/res/images/usage_02.png" alt="Chọn sản phẩm">
                </p>
            </div>
            
        </div>
    </div>
    
    <div id="page-05" style="background-color: #926f3c;padding: 20px 0px;margin-top:3rem;">
        <div class="container">
            <div class="row" style="padding-top: 1rem;padding-bottom: 1rem;text-align: center;">
                <ul id="footer-links">
                    <!-- <li><a href="/policy.html">Hướng dẫn mua hàng</a></li> -->
                    <li><a href="/payment.html">Hình thức thanh toán</a></li>
                    <li><a href="/delivery.html">Chính sách giao hàng</a></li>
                    <li><a href="/terms.html">Chính sách bảo hành đổi trả</a></li>
                    <li><a href="/policy.html">Chính sách bảo mật thông tin</a></li>
                </ul>
            </div>

            <div class="row">
                <div class="col-xs-12">
                    <p style="font-size: 0.8rem;color: #fff">
                        <i><strong>*** H’Biang</strong> là tên nữ chính trong truyền thuyết Lang Biang của các dân tộc nói tiếng K’Ho ở Đà Lạt, để nhớ người bản xứ đã chia sẻ không gian sống cho người đến sau.</i>

                    </p>
                    <p style="font-size: 0.8rem;color: #fff">
                        <i>
                        <strong>*** Slogan</strong> của hãng cà phê, Tích cực, Sảng khoái, dựa theo slogan không chính thức của Đà Lạt, Dat Aliis Laetitiam Aliis Temperiem (Cho người này sự sảng khoái,
      cho người kia sự mát lành).
                    </i>
                    </p>
                </div>

            </div>
            <div class="row" style="padding-top: 2rem;">
                <div class="col-sm-12">
                    <p style="color: #fff">Copyright © 2021 H'Biang Coffee Roastery. All Rights Reserved.</p>
                </div>
            </div>
        </div>

    </div>
  </div>
</div>

    <script src="/v2/res/lib/jquery/jquery.min.js"></script>
    <script src="/v2/res/lib/tether/js/tether.js"></script>
    <script src="/v2/res/lib/bootstrap/js/bootstrap.js"></script>
    <script src="/v2/res/js/imagemap.js"></script>
    
    <script>

        var products = [
            { name: 'H\'Biang *', id: 1, price: 100000, qty: 0},
            { name: 'H\'Biang **', id: 2, price: 150000, qty: 0},
            { name: 'H\'Biang ***', id: 3, price: 200000, qty: 0},
        ];

        function updateProductQty(id, qty) {
            if (id >0 && id <= 3)
                products[id-1].qty = qty;
        }

        function calcTotal() {
            var sum = 0;

            for(var i = 0; i < products.length; i++) {
                sum += products[i].qty * products[i].price;
            }

            return sum;
        }

        function removeProduct(id) {
            for(var i = 0; i < products.length; i++) {
                if (products[i].id == id)
                    products[i].qty = 0;
            }

            renderShoppingCart();
        }

        function addProduct(id) {
            for(var i = 0; i < products.length; i++) {
                if (products[i].id == id) {
                    if (products[i].qty < 1)
                        products[i].qty = 1;
                }
            }

            renderShoppingCart();
        }

        // format currency to VNĐ
        function formatCurrency(num) {
            return num.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1.") + 'đ';
        }

        function renderShoppingCart() {
             var index = 1;
             var htmlString = '';

             $('#cart-products tbody')
                .empty();

             for(var i = 0; i < products.length; i++) {
                var product = products[i];
                if (product.qty > 0) {
                    itemHtml = '<tr productid="' + product.id + '"><th class="hidden-xs-down" scope="row">' + index + '</th>'
                    + '<td>' + product.name + '</td>'
                    + '<td class="text-xs-center">'
                        + '<input class="form-control text-xs-center product-qty" min="1" max="9999" type="number" value="' + product.qty + '" id="example-number-input">'
                    + '</td>'
                    + '<td class="text-xs-right">' + formatCurrency(product.qty * product.price) + '</td>'
                    + '<td class="text-xs-right">'
                        + '<button type="button" class="btn btn-secondary btn-sm product-remove" productid="' + product.id + '" style="box-shadow: none" title="Xóa">'
                            + '<i style="color:#aaa;font-size: 1.0rem" class="fa fa-times-circle"></i>'
                        + '</button>'
                    '</td></tr>';

                    htmlString += itemHtml;

                    index++;
                }
             }

             if (htmlString != '') {
                htmlString += ' <tr>'    
                htmlString += '<th class="hidden-xs-down" scope="row"></th>'
                htmlString += '<td colspan="2" class="text-xs-right">'
                htmlString += 'Tổng cộng'
                htmlString += '</td>'                    
                htmlString += '<td class="text-xs-right" style="font-size: 1.2rem"><strong>' + formatCurrency(calcTotal()) + '</strong></td>'
                htmlString += '<td></td>'
                htmlString += '</tr>';

                $('#cart-products tbody')
                .empty()
                .append($(htmlString));

                bindCartEvents();
             }  else {
                 $('#myModal').modal('hide');
             }         
        }

        function bindCartEvents() {
            $('#cart-products .product-remove').bind('click', function() {
                var btn = $(this);
                var row = btn.closest('tr');
                var productid = row.attr('productid');

                removeProduct(productid);
                
                renderShoppingCart();
            });

            $('#cart-products .product-qty').change(function() {
                var number = $(this);
                var qty = number.val();
                
                var row = number.closest('tr');
                var productid = row.attr('productid');

                if (products[productid - 1].qty != qty) {
                    updateProductQty(productid, qty);

                    renderShoppingCart();
                }                
            });
        }

        function orderFormValidation() {
            $('#order-form .form-group').removeClass('has-danger');
            $('#order-form .form-control-feedback').hide();         

            var name = $('#order-form #txt_name');
            if (name.val() == '') {
                var row = name.closest('.form-group');
                row.addClass('has-danger');
                row.find('.form-control-feedback').show();

                name.focus();
                return false;
            }

            var contact = $('#order-form #txt_contactinfo');
            if (contact.val() == '') {
                var row = contact.closest('.form-group');
                row.addClass('has-danger');
                row.find('.form-control-feedback').show();

                contact.focus();
                return false;
            }

            return true;
        }

        function contactFormValidation() {
            $('#contact-form .form-group').removeClass('has-danger');
            $('#contact-form .form-control-feedback').hide();            

            var name = $('#contact-form #txt_name');
            if (name.val() == '') {
                
                var row = name.closest('.form-group');
                row.addClass('has-danger');
                row.find('.form-control-feedback').show();

                name.focus();                

                return false;
            }

            var contact = $('#contact-form #txt_contactinfo');
            if (contact.val() == '') {
                var row = contact.closest('.form-group');
                row.addClass('has-danger');
                row.find('.form-control-feedback').show();

                contact.focus();
                return false;
            }

            var notes = $('#contact-form #txt_notes');
            if (notes.val() == '') {
                var row = notes.closest('.form-group');
                row.addClass('has-danger');
                row.find('.form-control-feedback').show();

                notes.focus();
                return false;
            }

            return true;
        }

        function submitContactForm() {
            $.ajaxSetup({
                crossDomain: true,
                xhrFields: {
                    withCredentials: false
                }
            });

             $.post('https://us-central1-hbiang.cloudfunctions.net/emailContact', 
                $('#contact-form').serialize()
             , function (res) {
                if (res) {
                    $('#resultModal').modal();
                    $('#contact-form')[0].reset();
                }
             });         
        }

        function submitOrderForm() {
            $.ajaxSetup({
                crossDomain: true,
                xhrFields: {
                    withCredentials: false
                }
            });

            // update product quantity before submit
            for(var i = 0; i < products.length; i++) {
                var id = '#product' + (i*1 + 1) + '_qty';
                $(id).val(products[i].qty);                
            }

             $.post('https://us-central1-hbiang.cloudfunctions.net/emailOrder', 
                $('#order-form').serialize()
             , function (res) {
                if (res) {
                    $('#myModal').modal('hide');
                    $('#resultModal').modal();
                    $('#order-form')[0].reset();
                }
             });         
        }

        function showResultDialog() {
            $('#resultModal').modal();
        }

        $(document).ready(function() {
            $('.form-control-feedback').hide();

            // re-map when resize image
            $('map').imageMapResize();
            
            // back to top button
            $('<p id="back-to-top" style="display:none;"><a href="#top" alt="Back to top"><span></span></a></p>')
                .click(function () {
                    $('html,body').animate({
                        scrollTop: 0
                    }, 800);
                    return false;
                })
                .appendTo($('body'));

            // order button event
            $('#btn-order').bind('click', function() {
                if (orderFormValidation()) {
                    submitOrderForm();
                }
            });

             $('#btn-contact').bind('click', function(e) {
                e.preventDefault();

                if (contactFormValidation()) {
                    submitContactForm();
                }

                return false;
            });

            // handle add product button
            $(".product").on("click", function(e){
                e.preventDefault();
                var item = $(this);
                var id = item.attr('productid');
                
                addProduct(id);
                renderShoppingCart();

                console.log(products);

                $('#myModal').modal();
            });
        });      
        
        // scroll to top
        function animateButton() {
            var button = $('#back-to-top');
            var scrollPosition = $(window).scrollTop();
            if (scrollPosition > 1200) {
                button.fadeIn();
            } else {
                button.fadeOut();
            }
        }       

        /**
         * Run the animateButton function on window resize, scroll, and load.
         */

         
        $(window).resize(animateButton);
        $(window).scroll(animateButton);
        $(window).on('load', function () {
            animateButton();
        });

        //num.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")
        ///(\d)(?=(\d{3})+$)/g
    </script>
</body>

</html>
